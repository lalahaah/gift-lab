# **4\. 기프트랩(Gift Lab) 유저 플로우 차트 (User Flow)**

|

| 문서 버전 | 작성일 | 작성자 | 상태 |  
| v1.0 | 2026-01-05 | Next Engine | 확정 |

## **1\. 개요 (Overview)**

본 문서는 사용자가 앱을 실행하고(Start), AI 추천을 받고(Process), 상품을 구매하러 나가는(End) 전체 여정을 정의한다. **수익화(광고/제휴)가 자연스럽게 녹아드는 흐름**을 설계하는 것이 핵심이다.

## **2\. 핵심 플로우 다이어그램 (Mermaid Chart)**

전체적인 흐름을 한눈에 파악하기 위한 도식화입니다.

graph TD  
    %% 노드 스타일 정의  
    classDef start fill:\#f9f,stroke:\#333,stroke-width:2px;  
    classDef process fill:\#e1f5fe,stroke:\#0277bd,stroke-width:2px;  
    classDef decision fill:\#fff9c4,stroke:\#fbc02d,stroke-width:2px;  
    classDef monetization fill:\#ffcdd2,stroke:\#c62828,stroke-width:2px,stroke-dasharray: 5 5;  
    classDef endNode fill:\#c8e6c9,stroke:\#2e7d32,stroke-width:2px;

    Start((앱 실행)):::start \--\> Splash\[스플래시 화면\\n(로고 애니메이션)\]  
    Splash \--\> AuthCheck{사용자 인증 여부}:::decision  
      
    AuthCheck \-- 첫 실행 \--\> AnonAuth\[Supabase 익명 로그인\\n(UUID 발급)\]:::process  
    AuthCheck \-- 재방문 \--\> MainHome\[메인/입력 시작 화면\]  
    AnonAuth \--\> MainHome

    subgraph "입력 프로세스 (Data Collection)"  
        MainHome \--\> Step1\[Step 1: 대상/관계 선택\]  
        Step1 \--\> Step2\[Step 2: 기념일 종류 선택\]  
        Step2 \--\> Step3\[Step 3: MBTI/성격 입력\]  
        Step3 \--\> Step4\[Step 4: 예산 범위 설정\]  
        Step4 \--\> Step5\[Step 5: 제외 조건/옵션\]  
        Step5 \--\> Validate{입력값 유효성 검사}:::decision  
    end

    Validate \-- 실패 \--\> ErrorToast\[에러 메시지 노출\]  
    Validate \-- 성공 \--\> RequestAnalysis\[분석 요청 버튼 클릭\]

    subgraph "분석 및 수익화 (Core Logic)"  
        RequestAnalysis \--\> Loading\[로딩 화면\\n(연구소 애니메이션)\]  
        Loading \--\> CallAI\[AI 추천 요청 (Edge Function)\]:::process  
        Loading \--\> LoadAd\[AdMob 전면 광고 로드\]:::monetization  
          
        CallAI \--\> AI\_Response{AI 응답 완료?}:::decision  
        AI\_Response \-- 성공 \--\> ShowAd\[전면 광고 노출\]:::monetization  
        AI\_Response \-- 실패 \--\> Retry{재시도?}:::decision  
    end

    ShowAd \--\> CloseAd\[광고 닫기 클릭\]  
    CloseAd \--\> ResultPage\[결과 리스트 화면\]

    subgraph "전환 및 이탈 (Conversion)"  
        ResultPage \--\> BrowseCard\[추천 카드 스와이프\]  
        BrowseCard \--\> ClickLink\[최저가 확인 버튼 클릭\]  
          
        ClickLink \--\> LogClick\[클릭 데이터 로깅\]:::process  
        LogClick \--\> CheckApp{쿠팡 앱 설치 확인}:::decision  
          
        CheckApp \-- 설치됨 \--\> OpenDeepLink\[쿠팡 앱 실행\\n(DeepLink)\]:::endNode  
        CheckApp \-- 미설치 \--\> OpenWeb\[쿠팡 웹페이지 실행\]:::endNode  
          
        ResultPage \--\> Share\[카카오톡 공유\]  
        ResultPage \--\> Reset\[다시하기 (처음으로)\]  
    end

    Reset \--\> MainHome

## **3\. 단계별 상세 플로우 (Detailed Flow Description)**

### **Flow A. 진입 및 초기화 (Entry)**

사용자가 앱을 켜고 입력 준비 상태가 될 때까지의 과정입니다.

1. **Splash Screen (2초)**  
   * Lottie 애니메이션 재생.  
   * 백그라운드: 네트워크 연결 확인 및 signInAnonymously() 수행.  
2. **Auth Check**  
   * 로그인 실패(네트워크 오류 등) 시: "네트워크를 확인해주세요" 다이얼로그 노출 → '재시도' 버튼.  
   * 성공 시: 메인 화면으로 자동 전환.

### **Flow B. 선물 의뢰 입력 (Input \- 5 Steps)**

사용자의 이탈을 막기 위해 한 화면에 하나의 질문만 던집니다 (PageView).

1. **Step 1 (Who):** "누구에게 주나요?" → 버튼 선택 시 즉시 '다음'으로 스크롤(Auto Scroll) 가능하게 하여 속도감 부여.  
2. **Step 2 (Event):** "어떤 날인가요?" → 생일, 집들이 등 선택.  
3. **Step 3 (Persona):** "성격은 어떤가요?"  
   * MBTI 토글(E/I, N/S...) 조작 시 하단에 실시간으로 "활발하고 현실적인 리더형" 같은 한 줄 요약 문구 업데이트 (피드백).  
4. **Step 4 (Budget):** "예산은요?" → 슬라이더 조작 시 금액 표시. (예: 3만원 \~ 5만원).  
5. **Step 5 (Exclusion):** "피하고 싶은 선물은?" → 입력 후 키보드 '완료' 누르면 하단 'AI 연구원에게 의뢰하기' 버튼 활성화.

### **Flow C. 분석 및 광고 (Monetization Timing)**

이 앱의 **수익화 핵심 구간**입니다. 사용자가 가장 기대하고 기다리는 시간을 활용합니다.

1. **로딩 화면 진입**  
   * 문구: "수석 연구원이 {관계}님을 위한 선물을 분석 중입니다..." (동적 문구).  
   * 동작 1 (AI): 서버에 데이터 전송 및 응답 대기.  
   * 동작 2 (Ad): InterstitialAd.load() 호출.  
2. **분석 완료 시점**  
   * AI 데이터가 도착하면 로딩 애니메이션을 멈추지 않고, **전면 광고를 show()** 한다.  
   * *전략:* 광고가 로드되지 않았을 경우(Fill rate 이슈), 대기하지 않고 바로 결과 페이지로 이동하여 UX 저해를 막는다.

### **Flow D. 결과 확인 및 전환 (Result & Conversion)**

1. **결과 페이지 (Swiper UI)**  
   * 카드 1번부터 3\~5번까지 가로로 넘겨보는 방식.  
   * 각 카드 하단에 AdMob 배너 광고 고정 노출.  
2. **Outlink Action (DeepLink)**  
   * 사용자가$$최저가 보러가기$$  
     버튼 터치.  
   * **Logic:**  
     1. click\_logs 테이블에 INSERT (비동기).  
     2. canLaunchUrl('coupang://...') 체크.  
     3. true: 쿠팡 앱 실행.  
     4. false: 인앱 브라우저가 아닌 \*\*외부 브라우저(Safari/Chrome)\*\*로 https://coupang.com... 실행 (쿠팡 앱 설치 유도 및 세션 유지 유리).

### **Flow E. 재사용 및 확장 (Retention)**

1. **공유하기**  
   * $$공유$$  
     버튼 클릭 → 카카오톡 실행 → "OO님이 추천하는 선물 리스트" 메시지 발송.  
2. **다시하기**  
   * 결과 화면 하단$$다른 사람 선물 찾기$$  
     버튼.  
   * 클릭 시 입력 폼 초기화(Reset Provider) 후 Step 1으로 이동.

## **4\. 예외 처리 플로우 (Edge Cases)**

| 상황 | 발생 시점 | 처리 시나리오 |  
| 네트워크 끊김 | 앱 실행 중 언제나 | 현재 작업을 중단하고 "인터넷 연결이 필요합니다" 스낵바 노출. |  
| AI 응답 시간 초과 | 로딩 화면 (10초 이상) | "연구원이 너무 많은 고민을 하고 있네요. 다시 시도해주세요." 메시지 후 Step 5로 복귀. |  
| AI 결과 없음/오류 | 분석 완료 시점 | (JSON 파싱 에러 등) 사전에 준비된 '베스트셀러(안전빵)' 목록 3개를 대신 보여줌 (사용자는 에러인지 모름). |  
| 쿠팡 앱 미설치 | 구매 버튼 클릭 시 | 모바일 웹 브라우저로 리다이렉트 (DeepLink Fallback). |